<!-- 这是一张图片，ocr 内容为： -->
![](https://cdn.nlark.com/yuque/0/2026/png/21482780/1770133396429-9f5c7c77-7b35-4eb4-a7dc-79c3fa9b5862.png)

## <font style="color:black;">1. EOA 钱包（Externally Owned Account）核心功能概览</font>
+ <font style="color:black;">账户管理：创建、导入、导出</font>
+ <font style="color:black;">密钥形式支持： </font>
    - <font style="color:black;">原始私钥（32 bytes）</font>
    - <font style="color:black;">助记词（BIP-39）</font>
    - <font style="color:black;">Keystore（加密私钥文件）</font>
    - <font style="color:black;">MPC 分片密钥（TSS / SSS）</font>
+ <font style="color:black;">交易相关：构造 tx → 签名 → 发送</font>
+ <font style="color:black;">附加功能： </font>
    - <font style="color:black;">资产展示（余额、价值换算） </font>
    - <font style="color:black;">交易记录 </font>
    - <font style="color:black;">内置浏览器 / dApp 连接 </font>
    - <font style="color:black;">Swap / 跨链 / 资产交易等</font>

## <font style="color:black;">2. EOA账号密钥创建</font>
### 前置知识
定义了一些规范，私钥怎么生成。怎么好记

#### <font style="color:black;">HD钱包（分层确定性钱包）</font>
+ <font style="color:black;">BIP-39</font><font style="color:black;"> → 助记词（人类友好备份）</font>
+ <font style="color:black;">BIP-32</font><font style="color:black;"> → 分层派生算法（树状无限生成）</font>
+ <font style="color:black;">BIP-44 → 路径标准（告诉大家第几层是哪个币、哪个账户）</font>

<font style="color:black;">HD 钱包 = 用一套助记词（BIP-39） → 通过树状确定性算法（BIP-32） → 按照标准路径（BIP-44） → 生成你所有链、所有账户的私钥和地址。</font>





<font style="color:black;">HD钱包从种子到私钥到地址DEMO： </font>

[https://github.com/OpenSpace100/account_demo/blob/master/create_by_mnemonic.js](https://github.com/OpenSpace100/account_demo/blob/master/create_by_mnemonic.js)

[https://learnblockchain.cn/2018/09/28/hdwallet/](https://learnblockchain.cn/2018/09/28/hdwallet/)

### <font style="color:black;">原始私钥（32 bytes）</font>
随机数

### <font style="color:black;">助记词（BIP-39）</font>
通过<font style="color:black;">助记词来生成密钥</font>

### <font style="color:black;">Keystore（加密私钥文件）</font>
Keystore 文件就是一种以加密的方式存储密钥的文件（加强安全性），签名前先解析出私钥。

原理： 使用 scrypt 算法从密码派生加密密钥， 用加密密钥使用 AES-128-CTR 算法加密私钥。



<font style="color:black;">Keystore 生成及校验：</font>

[https://github.com/lbc-team/hello_viem/blob/main/demo/src/keystore_demo.js](https://github.com/lbc-team/hello_viem/blob/main/demo/src/keystore_demo.js)

<font style="color:black;">Keystore 发起交易</font>

[https://github.com/lbc-team/hello_viem/blob/main/demo/src/build_tx_keystore.ts](https://github.com/lbc-team/hello_viem/blob/main/demo/src/build_tx_keystore.ts)



### <font style="color:black;">MPC 分片密钥（TSS / SSS）</font>
<font style="color:black;">• MPC（Multi-Party Computation）多方计算</font>

<font style="color:black;">• 利用 MPC 技术可将私钥分片, 每个分片由不同的参与方保管, 通过 m/n 个分片聚合出私钥（或签名）。</font>

<font style="color:black;">• SSS （ Shamir's Secret Sharing ）：聚合后签名</font>

<font style="color:black;">• TSS（ Threshold Signature Scheme ）：聚合签名 ，大多数项目采用的方案</font>

<font style="color:black;">• 部分分片泄露，私钥仍然安全，降低了单点故障风险</font>

[https://github.com/lbc-team/hello_viem/blob/main/demo/src/mpc_tx.js](https://github.com/lbc-team/hello_viem/blob/main/demo/src/mpc_tx.js)



## <font style="color:black;">3、账号密钥创建方式对比</font>
| **<font style="color:black;">创建方式</font>** | **<font style="color:black;">随机性 / 熵源</font>** | **<font style="color:black;">备份难度</font>** | **<font style="color:black;">管理便利性</font>** | **<font style="color:black;">主流曲线</font>** | **<font style="color:black;">典型代表项目 / 链</font>** | **<font style="color:black;">安全性备注</font>** |
| --- | --- | --- | --- | --- | --- | --- |
| <font style="color:black;">纯随机私钥</font> | <font style="color:black;">必须高质量熵（如 /dev/urandom 或 256次硬币）</font> | <font style="color:black;">★★★★★</font> | <font style="color:black;">★☆☆☆☆</font> | <font style="color:black;">secp256k1</font> | <font style="color:black;">几乎所有 EOA 钱包</font> | <font style="color:black;">最原始，最容易丢失</font> |
| <font style="color:black;">HD 钱包（BIP-32 + BIP-44）</font> | <font style="color:black;">单一种子 → 树状派生</font> | <font style="color:black;">★★☆☆☆</font> | <font style="color:black;">★★★★★</font> | <font style="color:black;">secp256k1</font> | <font style="color:black;">MetaMask, Trust Wallet 等</font> | <font style="color:black;">助记词一词搞定多链多地址</font> |
| <font style="color:black;">助记词（BIP-39）</font> | <font style="color:black;">熵 → 助记词 → PBKDF2 → 种子</font> | <font style="color:black;">★★☆☆☆</font> | <font style="color:black;">★★★★★</font> | <font style="color:black;">secp256k1</font> | <font style="color:black;">绝大部分软件钱包</font> | <font style="color:black;">12/24 词成为事实标准</font> |
| <font style="color:black;">Keystore 文件</font> | <font style="color:black;">私钥 + 密码 → scrypt → AES-128-CTR 加密</font> | <font style="color:black;">★★★☆☆</font> | <font style="color:black;">★★★☆☆</font> | <font style="color:black;">—</font> | <font style="color:black;">MyEtherWallet 早期、部分老钱包</font> | <font style="color:black;">防暴力破解依赖密码强度</font> |
| <font style="color:black;">MPC / TSS 分片</font> | <font style="color:black;">私钥分片（2/3、3/5等阈值）</font> | <font style="color:black;">★☆☆☆☆</font> | <font style="color:black;">★★★★☆</font> | <font style="color:black;">secp256k1 / ed25519 等</font> | <font style="color:black;">OKX、Dynamic、Turnkey、Privy、Fireblocks 等</font> | <font style="color:black;">2026年主流嵌入式/机构方案</font> |


<font style="color:black;">2026年MPC钱包主流现状简讯</font>

+ <font style="color:black;">OKX Wallet：仍以2/3 TSS为主（设备 + OKX云 + 备份云） </font>
+ <font style="color:black;">Para（Passkey方案）：2-of-2 + Passkey跨设备同步（Google/Apple） </font>
+ <font style="color:black;">嵌入式钱包服务商Top：Privy（Stripe收购后更强）、Dynamic、Turnkey、Openfort、Alchemy嵌入式方案 </font>
+ <font style="color:black;">机构级：Fireblocks、Blockdaemon、Sepior、Qredo 等仍占主导</font>

<font style="color:black;"></font>

## <font style="color:black;">4、构造交易</font>
### 1. ABI 编码
• 函数选择器 + 参数编码  
• 函数选择器：函数签名的 Keccak 哈希的前 4 字节  
• 参数编码：第5个字节开始，基本类型扩容到 32 字节表示，复杂类型用起始位置、数据大小、真实数据

工具：  
• Foundry: cast abi-decode / cast abi-encode  
• Solidity: abi.decode / abi.encode  
• Web3.js / ethers.js / viem  
• [https://chaintool.tech/calldata](https://chaintool.tech/calldata)

### 2. 构造交易
```plain
Transaction {
    to: Address // 交易的接收者
    nonce: Hex // 发送者的nonce（已发送交易数量的计数）
    type: Hex // 交易类型, 0(legcy) 或 1(EIP-2930) 或 2(EIP-1559)
    value: Hex // 交易携带的主币数量, 单位是 wei
    data: Hex // 交易携带的数据 （ABI 编码）
    maxPriorityFeePerGas?: Hex // EIP-1559:每单位 gas 优先费用, type=2时提供
    maxFeePerGas?: Hex // EIP-1559:每单位 gas 最大费用, type=2时提供
    gas: Hex // 可使用的最大 gas 数量(gasLimit)
}
```

### 3. RLP 序列化、HASH、签名
[chainId, nonce, maxPriorityFeePerGas, maxFeePerGas, gas, to, value, data, accessList]

### 4. 广播交易、节点验证、执行打包
• RPC 节点收到交易  
• 验证：签名正确、确保交易费够、GasLimit 不超限制、chainID 匹配、Nonce是否符合预期  
• 放入交易池（mempool）  
• 从交易池取交易（一般按交易手续费排序）、EVM 执行

### 5.  完整的交易流程
• 创建私钥（或助记词、或导入）  
• 可选：查询余额、充值  
• 构造交易对象：{to: ，data:，value: , gas: …. , nonce: …}  
• 签名交易  
• 发送交易到节点

```plain
await txParams = {
    account: account,
    to: ‘’,
    value: parseEther('0.0001'), // 发送金额（ETH）
    chainId: sepolia.id,
    // EIP-1559 交易
    maxFeePerGas: parseGwei('40'), // 最大总费用（基础费用+小费）
    maxPriorityFeePerGas: parseGwei('2'), // 最大小费
    gas: 21000n, // 普通交易 - gas limit
    nonce: 1,
}
const signedTx = await walletClient.signTransaction(txParams)
const txHash = await publicClient.sendRawTransaction({
    serializedTransaction: signedTx
})
```

DEMO 代码：[https://github.com/lbc-team/hello_viem/blob/main/demo/src/build_raw_tx.ts](https://github.com/lbc-team/hello_viem/blob/main/demo/src/build_raw_tx.ts)



## 5、MetaMask钱包原理
### 1、METAMASK 如何签名的
• 通过插件在浏览器中注入了 window.ethereum  
• 获取账号

```plain
await window.ethereum.request({
    "method": "eth_accounts",
    "params": [],
});
```

• 发送交易

```plain
await window.ethereum.request({
    "method": "eth_sendTransaction",
    "params": [
        {
            "to": "0x4B0897b0513FdBeEc7C469D9aF4fA6C0752aBea7",
            "from": "0xfc03347e0168838eb029049f98a35b14bd612c40",
            "gas": “0x76c00",
            "value": "0x0100",
            "data": “0x…”,
            "maxFeePerGas": "0x4a817c800"
        }
]
});
```



## 7、硬件钱包
### 1、硬件钱包
“硬件钱包”和“冷钱包”常常被提及在一起：

• 冷钱包：一种离线存储私钥的方式，强调的是“不联网”

• 硬件钱包：是一种具体的冷钱包设备，强调的是“物理硬件”，需要配合软件钱包一起使用

• 硬件钱包： 安全芯片（存储私钥，防物理攻击、签名）、用 USB 或蓝牙通信签名信息与结果。



### 2、签名机
业务中，尽量保持私钥的服务期是隔离的，可以使用签名机 或 KSM 系统



## <font style="color:black;">8、智能合约钱包</font>
<font style="color:black;">又称账户抽象钱包/AA钱包【Account Abstraction Wallet】</font>

• 外部账户（EOA）与 合约账户在 EVM 层面是等效的，都是有：nonce（交

易序号）、balance（余额）、storageRoot（状态）、codeHash（代码）

• 如果该合约可以持有资金、调用任意合约方法，就是一个智能合约钱包账户

• 智能合约钱包账户：支持多签、multicall、密钥替换、找回

• AA（ERC4337 / ERC7702）： 抽象掉 EOA 与 智能合约钱包账户的区别

[https://learnblockchain.cn/article/5426](https://learnblockchain.cn/article/5426)

[https://github.com/OpenSpace100/blockchain-tasks/blob/main/solidity_sample_code/ContractWallet.sol](https://github.com/OpenSpace100/blockchain-tasks/blob/main/solidity_sample_code/ContractWallet.sol)



## 9、多签钱包SAFE
[https://safe.global/wallet](https://safe.global/wallet)





## 999、作业
### 作业1：
作业：使用 VIEM 构建一个 CLI 钱包

编写一个脚本（可以基于 Viem.js 、Ethers.js 或其他的库来实现）来模拟一个命令行钱包，钱包包含的功

能有：

• 1. 生成私钥、查询余额（可人工转入金额）

• 2. 构建一个 ERC20 转账的 EIP 1559 交易

• 3. 用 1 生成的账号，对 ERC20 转账进行签名

• 4. 发送交易到 Sepolia 网络。

[https://decert.me/quests/992dae0f-3bdf-4f03-9798-3427234fad95](https://decert.me/quests/992dae0f-3bdf-4f03-9798-3427234fad95)

<font style="color:black;"></font>

### <font style="color:black;">作业2：</font>
使用 Safe 多签：

• [https://decert.me/quests/4d4d50ab-84ab-4289-ac67-e3839e078537](https://decert.me/quests/4d4d50ab-84ab-4289-ac67-e3839e078537)

• 实现一个简单的多签钱包， 功能：

• 多签持有人可提交交易

• 其他多签人确认交易（使用交易的方式确认即可）

• 达到多签门槛、任何人都可以执行交易

[https://decert.me/quests/f832d7a2-2806-4ad9-8560-a27ad8570c6f](https://decert.me/quests/f832d7a2-2806-4ad9-8560-a27ad8570c6f)













